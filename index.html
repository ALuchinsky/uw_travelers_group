<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UW: Travelers Group</title>
  <link rel="stylesheet" href="./styles.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>

<script src="scripts.js"></script>



<body>

<script>
  function openPage(evt, tabName) {
  var i, tabcontent, tablinks;
  console.log("openPage called with tabName: " + tabName);
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].classList.remove("active");
  }
  var tab = document.getElementById(tabName);
  if (tab) {
    tab.style.display = "block";
  }
  if (evt) {
    evt.currentTarget.classList.add("active");
  } else {
    // Automatically mark the correct button active if evt is null (on load)
    for (i = 0; i < tablinks.length; i++) {
      if (tablinks[i].textContent === tabName) {
        tablinks[i].classList.add("active");
      }
    }
  }
}

window.onload = function() {
  const params = new URLSearchParams(window.location.search);
  const tab = params.get("tab") || "Presentations";
  openPage(null, tab);
};

</script>

<script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
</script>
<script type="text/javascript">
   (function(){
      emailjs.init({
        publicKey: "DssKR2IjqteHDCGO7",
      });
   })();
</script>

  <script>
    console.log("Hello, I am loading!")
    document.addEventListener('DOMContentLoaded', loadSchedule);
  </script>


  <script>
window.addEventListener("DOMContentLoaded", () => {
  const stored = localStorage.getItem("currentUser");
  if (stored) {
    currentUser = stored;
    document.getElementById("login-status").textContent = `Logged in as ${currentUser}`;
    document.getElementById("username").value = stored;
  }
});
  </script>

<div id="login-bar" style="padding: 10px; background: #eef; display: flex; gap: 10px; align-items: center;">
  <label for="username">Username:</label>
  <input type="text" id="username" placeholder="Enter your name">
  <button onclick="loginUser()">Login</button>
  <span id="login-status" style="margin-left: 10px; font-weight: bold;"></span>
</div>

<script>
  window.currentUser = null;

function loginUser() {
  const input = document.getElementById("username");
  const name = input.value.trim();

  if (!name) {
    alert("Please enter your name.");
    return;
  }

  window.currentUser = name;
  localStorage.setItem("currentUser", name);
  document.getElementById("login-status").textContent = `Logged in as ${window.currentUser}`;
  // document.getElementById("username").disabled = true;
}
</script>

    <h1> Travelers Group </h1>

    <!-- Tab links -->

<div class="tab">
  <button class="tablinks" onclick="openPage(event, 'Presentations')">Presentations</button>
  <button class="tablinks" onclick="openPage(event, 'Chat')">Chat</button>
</div>

<div id="Presentations" class="tabcontent" style="display: block;">

<p>
    The Travelers group, composed of both individuals and couples, typically meets from 5:00 PM to 7:00 PM on the 4th Sunday of the month from September through May.  The schedule for 2024-2025 may have some exceptions due to holidays.  Each month one or more members present hints and highlights about trips they have taken; from Yellowstone to Bhutan, from Ireland to Indonesia. Meetings are held in members’ homes or occasionally in a larger venue (which allows for more participants) and feature pot-luck food and beverage items. Members are requested to host, co-host, and/or present periodically.
</p>

<hr>
<h2> Future Presentations (2025 &ndash; 2026)</h2>


<button id = "revert_btn">Revert</button>
<script>
  document.getElementById("revert_btn").onclick = function() {
    console.log("clicked")
    window.schedule_data =JSON.parse(JSON.stringify(window.oldData))
    console.log(window.schedule_data)
    renderScheduleTable(window.schedule_data); // ✅ call render after loading

  }
</script>

<button id = "save_btn">Save</button>
<script>
  document.getElementById("save_btn").onclick = function() {
    console.log("Saving")
    email_data = {
      name: "Travel Club Website",
      user: window.currentUser,
      email: "aluchi@bgsu.edu",  // optional: use fixed or dynamic email
      message: JSON.stringify(window.schedule_data)
    }
    emailjs.send("service_xg53xju", "template_efpbkjn", email_data).then( () => {
      console.log("Email sent successfully")
      console.log("email_data = ", email_data)
    }).catch( (error) => {
      console.log("Email sent with error ", error)
    })
  }
</script>

<div id="schedule-table"></div>

<br>
Click <a href="./data/schedules/Schedule 2025 - 2026.xlsx">HERE</a> download the Excel file

<hr>
<h2> Past Presentations</h2>

<h3> 2024 &ndash; 2025</h3>

<div class="season">

<meeting-entry
    date = "October 27, 2024"
    title = "Cruising the Bay of Bengal:  From Mumbai to Bangkok"
    presenters = "Hilde Farrow"
>
</meeting-entry>

<meeting-entry
    date = "November 24, 2024"
    title = "TDA"
    presenters = "Milt Hakel"
></meeting-entry>

<meeting-entry 
  date="January 26, 2025" 
  title="Mexico tour" 
  presenters="Elayne and Joe Jacoby & Maria Fong">
</meeting-entry>


<meeting-entry
 date = "February 23, 2025"
 title = ""
 show_by="no"
 presenters = "no presentation"
>
</meeting-entry>

<meeting-entry
    date="March 23, 2025"
    title = "Egypt"
    presenters = "Winnie & Bob Rex"
></meeting-entry>

<meeting-entry
    date="April 27, 2025"
    title = ""
    show_by="no"
    presenters = "possible presenter pending"
>
</meeting-entry>

<meeting-entry
    date = "May 18, 2025"
    title = "Charleston"
    presenters = "Susan & George"
>
</meeting-entry>

</div>

<h3> 2023 &ndash; 2024</h3>

<div class="season">

<meeting-entry
    date = "December 3, 2023"
    title = "Textile Collecting Adventures in Indonesia (Festive Food for December Holidays)"
    presenters = "Sue &amp; Dave"
>
</meeting-entry>

<br>
<table>
    <tr>
        <td width = 20%> January 28, 2024 </td>
        <td> <span style="color:chocolate"> If Your Friend Offers You Their Yurt on Orcas Island, Say Yes! And Other Stories from Washington State </span></td>
    </tr>
    <tr>
        <td></td>
        <td>by Guest speakers;  Holly Brians &amp; Damon Ragusa </td>
    </tr>
</table>

<meeting-entry
    date="February 25, 2024"
    title="Canary Islands"
    presenters="Marilyn Shrude &amp; Sampen"
>
</meeting-entry>

<meeting-entry
    date="March 24, 2024"
    title="Top Secret Russian Town"
    presenters="Dasha &amp; Alexey"
>
    <div class="event">
        <img src = "./data/presentations/2024_Mar_24/slide_1.png" style="width:40%"/>
        <img src = "./data/presentations/2024_Mar_24/musical_school.png" style="width:40%"/>
        <img src = "./data/presentations/2024_Mar_24/Gazibo_summer.png" style="width:40%"/>
        <img src = "./data/presentations/2024_Mar_24/Gazibo_winter.png" style="width:40%"/>
    <br>
    CLICK <a href="data/presentations/2024_Mar_24/SNZ_presentation.pptx.pdf">here</a> to download the complete presentation
    </div>
</meeting-entry>

<meeting-entry
    date="April 28, 2024"
    title="Egypt"
    presenters="Winnie &amp; Bob Rex"
></meeting-entry>

<meeting-entry
    date="May 19, 2024"
    title="Utah Canyons"
    presenters="Joan &amp; Bob Callecod"
></meeting-entry>

</div>

<h3> 2023</h3>

<div class="season">

    <meeting-entry
        date="May 21, 2023"
        title="Argentine Dance Culture"
        presenters="Stefani Hathaway ​and partner"
    >
        <div class="event">
                <img src = "./data/presentations/May_21_2023/dance.png" style="width:200px"/>
                <img src = "./data/presentations/May_21_2023/dance_2.png" style="width:200px"/>
        </div>
    </meeting-entry>

</div>

<hr>

  <script>
    console.log("Hello, I have downloaded!")
  </script>
</div>

<div id="Chat" class="tabcontent" style="display: block;">

<textarea id="chat_text" style="width: 100%; height: 70px; padding: 10px;">
</textarea>
<button id="send_chat_btn" onclick="sendMessage()">Send</button>
<div id="chat-box"/>

<script>
    const supabaseUrl = 'https://ooqcydaootqkowkhxhil.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vcWN5ZGFvb3Rxa293a2h4aGlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjI2OTMsImV4cCI6MjA2NzYzODY5M30.NWS0b0alWEj9KAHpHyrcfyQ-2bri571atC0IEVBNeHI';
    const client_chat = window.supabase.createClient(supabaseUrl, supabaseKey);

async function sendMessage() {
  const author = window.currentUser;
  const content = document.getElementById("chat_text").value.trim();

  if (!author || !content) return;

  to_insert =     {
      author: author,
      content: content,
      time: new Date().toLocaleTimeString([], {
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      })
    }
  console.log("inserting ", to_insert)

  await client_chat.from("messages").insert([to_insert]);

  document.getElementById("chat_text").value = "";
  await loadChatMessages(); // refresh after send
}

async function loadChatMessages() {
  // console.log("Loading chat messages")
  const { data, error } = await client_chat
    .from("messages")
    .select("*")
    .order("time", { ascending: false });

  if (error) {
    console.error("Failed to load messages:", error);
    return;
  }

  const chatBox = document.getElementById("chat-box");
  const html = data.map(msg => {
    // console.log(msg)
    return(`<div><strong>${msg.author}</strong>:<small>${msg.time}</small><br>&nbsp;&nbsp;&nbsp; ${msg.content}</div>`)
  }
  ).join("");
  chatBox.innerHTML = html


  // auto-scroll to bottom
  chatBox.scrollTop = chatBox.scrollHeight;
}

// auto-refresh every 50 seconds
setInterval(loadChatMessages, 5000);
document.addEventListener("DOMContentLoaded", loadChatMessages);

document.getElementById("chat_text").addEventListener("keydown", function (event) {
  if (event.key === "Enter" && !event.shiftKey) {
    event.preventDefault(); // prevent new line
    sendMessage();          // your function
  }
});

</script>




</div>

</body>

</html>